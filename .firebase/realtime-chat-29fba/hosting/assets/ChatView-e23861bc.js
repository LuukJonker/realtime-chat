import{d as f,t as q,b as u,f as l,u as p,x as k,g as b,h as M,e as n,m as N,_ as m,y as S,r as $,z as P,A as V,B as O,C as v,a as x,D as B,E,j as T,c as y,R as z,F as I,G as C,H as U,I as j,w as A,v as F,J as H,K as G,i as J,L as K}from"./index-19da06e0.js";import{P as L}from"./profile-icon-cbb7c51f.js";const Q={class:"flex justify-between items-center bg-primary text-onLight p-2 m-2 rounded-lg"},W={class:"flex justify-start items-center gap-2"},X=["src"],Y={class:"text-xl"},Z=f({__name:"ProfileSection",props:{user:{type:Object,required:!0}},setup(a){return(t,c)=>{const s=q("RouterLink");return n(),u("div",Q,[l("div",W,[l("img",{src:t.user.photoURL?t.user.photoURL:p(L),alt:"Profile",class:"w-16 aspect-square object-cover rounded-full",referrerpolicy:"no-referrer"},null,8,X),l("h1",Y,k(t.user.displayName),1)]),b(s,{to:"/settings",class:"bg-primary text-onLight p-2 rounded-lg"},{default:M(()=>[N("Settings")]),_:1})])}}}),ee=m(Z,[["__file","/home/luuk/code/realtime-chat/src/components/ProfileSection.vue"]]),D=S("users",()=>{const a=$([]);return P(async()=>{a.value=await V()}),{users:a}}),w=S("chats",()=>{const a=$([]),t=new Set,c=e=>t.has(e),s=e=>{t.has(e)||(B(e,({messages:o,source:h})=>{h!=="local"&&(a.value=a.value.map(d=>(d.id===e&&(d.messages=o),d)))}),t.add(e))};O(e=>{a.value=e,e.forEach(o=>s(o.id))});const r=v(()=>{const e=new Set;return a.value.forEach(o=>{o.participants.forEach(h=>{var d;h!==((d=x.currentUser)==null?void 0:d.uid)&&e.add(h)})}),e});return{chats:a,contacts:r,isSubscribed:c,subscribe:s}}),te=["src"],se={class:"flex flex-col gap-2"},re=f({__name:"UserCard",props:{user:{type:Object,required:!0}},setup(a){const c=a.user,s=async()=>{var e;if(!x.currentUser)return;const r=await E([c.id,(e=x.currentUser)==null?void 0:e.uid]);T.push(`/${r}`)};return(r,e)=>(n(),u("button",{onClick:s,class:"flex gap-4 p-4 rounded-lg items-center bg-surface-200"},[l("img",{src:p(c).photoURL?p(c).photoURL:p(L),alt:"Profile",height:"64",width:"64",class:"w-16 aspect-square rounded-full object-cover",referrerpolicy:"no-referrer"},null,8,te),l("div",se,[l("h2",null,k(p(c).displayName),1)])]))}}),ae=m(re,[["__file","/home/luuk/code/realtime-chat/src/components/userCard/UserCard.vue"]]),ne=["src"],oe={class:"flex flex-col gap-[2px]"},ce={class:"text-lg text-onDark"},ue={key:0,class:"text-onDark emphasis-high"},le={key:1,class:"text-onDark emphasis-high animate-pulse"},ie=f({__name:"ContactCard",props:{chat:{type:Object,required:!0}},setup(a){const t=a,c=D(),s=v(()=>{var d;if(t.chat.groupchat)return{displayName:t.chat.groupchat.name,photoURL:t.chat.groupchat.photoURL};const e=(d=x.currentUser)==null?void 0:d.uid,o=t.chat.participants.find(i=>i!==e);return c.users.find(i=>i.id===o)??{}}),r=v(()=>{var e,o,h;return console.log("Computing",t.chat,(o=(e=t.chat.messages)==null?void 0:e.at(0))==null?void 0:o.content),(h=t.chat.messages)==null?void 0:h.at(0)});return(e,o)=>e.$props.chat.messages?(n(),y(p(z),{key:0,to:`/${e.chat.id}`,class:"flex items-center rounded-lg p-4 gap-4 bg-surface-400 hover:bg-surface-500"},{default:M(()=>[l("img",{src:s.value.photoURL?s.value.photoURL:p(L),alt:"Profile",height:"64",width:"64",class:"w-16 aspect-square rounded-full object-cover",referrerpolicy:"no-referrer"},null,8,ne),l("div",oe,[l("h2",ce,k(s.value.displayName),1),r.value?(n(),u("p",ue,k(r.value.content),1)):(n(),u("div",le))])]),_:1},8,["to"])):I("v-if",!0)}}),R=m(ie,[["__file","/home/luuk/code/realtime-chat/src/components/contactCard/ContactCard.vue"]]),he={key:0,class:"flex-1 flex flex-col gap-2 mx-2 mt-4"},de=l("h2",{class:"text-lg text-onDark emphasis-high"},"Contacts",-1),pe={key:1,class:"flex-1 flex flex-col gap-2 mx-2 mt-4"},_e=l("h2",{class:"text-lg text-onDark emphasis-high"},"Users",-1),fe={key:2,class:"flex-1 flex justify-center items-center"},me=l("p",{class:"text-2xl"},"No users found",-1),ge=[me],ve=f({__name:"UserList",props:{search:{type:String,required:!0}},setup(a){const t=a,c=D(),s=w(),r=s.contacts,e=v(()=>{const i=t.search.toLowerCase();return c.users.filter(_=>_.displayName.toLowerCase().includes(i))}),o=v(()=>e.value.filter(i=>r.has(i.id))),h=v(()=>s.chats.filter(i=>i.participants.some(_=>{var g;return _===((g=x.currentUser)==null?void 0:g.uid)}))),d=v(()=>e.value.filter(i=>{var _;return i.id===((_=x.currentUser)==null?void 0:_.uid)?!1:!r.has(i.id)}));return(i,_)=>(n(),u(C,null,[o.value?(n(),u("div",he,[de,(n(!0),u(C,null,U(h.value,g=>(n(),y(R,{key:g.id,chat:g},null,8,["chat"]))),128))])):I("v-if",!0),e.value?(n(),u("div",pe,[_e,(n(!0),u(C,null,U(d.value,g=>(n(),y(ae,{key:g.id,user:g},null,8,["user"]))),128))])):(n(),u("div",fe,ge))],64))}}),xe=m(ve,[["__file","/home/luuk/code/realtime-chat/src/components/userCard/UserList.vue"]]),ye={key:0,class:"flex-1 flex flex-col gap-2 mx-2 mt-4"},Ce=f({__name:"ChatList",setup(a){const t=w(),{chats:c}=j(t);return(s,r)=>p(c).length?(n(),u("div",ye,[(n(!0),u(C,null,U(p(c),e=>(n(),y(R,{key:e.id,chat:e},null,8,["chat"]))),128))])):I("v-if",!0)}}),ke=m(Ce,[["__file","/home/luuk/code/realtime-chat/src/components/contactCard/ChatList.vue"]]),$e=f({__name:"UserSection",setup(a){const t=$("");return(c,s)=>(n(),u(C,null,[A(l("input",{"onUpdate:modelValue":s[0]||(s[0]=r=>t.value=r),type:"text",placeholder:"Search",class:"p-2 mx-2 rounded-xl text-onDark focus:outline-none text-lg bg-surface-200"},null,512),[[F,t.value]]),t.value?(n(),y(xe,{key:0,search:t.value},null,8,["search"])):(n(),y(ke,{key:1}))],64))}}),be=m($e,[["__file","/home/luuk/code/realtime-chat/src/components/UserSection.vue"]]),Ue={class:"text-xs emphasis-low"},Ie=f({__name:"ChatMessage",props:{message:{type:Object,required:!0}},setup(a){const t=x.currentUser,c=s=>{const r=s.getHours(),e=s.getMinutes(),o=r<10?`0${r}`:`${r}`,h=e<10?`0${e}`:`${e}`;return`${o}:${h}`};return(s,r)=>{var e,o;return n(),u("div",{class:H(["flex flex-col gap-1 p-2 rounded-lg w-80",{"self-end items-end bg-primary text-onLight":s.message.senderId===((e=p(t))==null?void 0:e.uid),"self-start items-start bg-surface-400 text-onDark":s.message.senderId!==((o=p(t))==null?void 0:o.uid)}])},[l("p",null,k(s.message.content),1),l("p",Ue,k(c(s.message.createdAt.toDate())),1)],2)}}}),we=m(Ie,[["__file","/home/luuk/code/realtime-chat/src/components/chat/ChatMessage.vue"]]),Se=S("inputMessages",()=>{const a=$(new Map);function t(r,e){a.value.set(r,e)}function c(r){a.value.delete(r)}function s(r){return a.value.get(r)??""}return{inputMessages:a,addInputMessage:t,removeInputMessage:c,getInputMessage:s}}),Le={class:"flex w-full bg-surface-200 p-2"},Me=["onSubmit"],je=["value"],De=l("button",{type:"submit",class:"bg-primary rounded-full w-16 p-2 mx-2 h-10 flex justify-center items-center text-onLight"}," Send ",-1),Re=f({__name:"ChatInput",props:{chatId:{type:String,required:!0}},setup(a){const t=a,{addInputMessage:c,removeInputMessage:s,getInputMessage:r}=Se(),{subscribe:e}=w(),o=$("");G(()=>t.chatId,()=>{o.value=r(t.chatId)});const h=i=>{const _=i.target;c(t.chatId,_.value),e(t.chatId),o.value=_.value},d=async()=>{const i=K(t.chatId,o.value);o.value="",s(t.chatId),await i};return(i,_)=>(n(),u("div",Le,[l("form",{class:"flex-1 flex",onSubmit:J(d,["prevent"])},[l("input",{type:"text",class:"flex-1 p-2 rounded-xl text-onDark focus:outline-none text-lg bg-surface-300",placeholder:"Type a message...",value:o.value,onInput:h},null,40,je),De],40,Me)]))}}),qe=m(Re,[["__file","/home/luuk/code/realtime-chat/src/components/chat/ChatInput.vue"]]),Ne={class:"flex flex-col h-full flex-1"},Pe={key:0,class:"flex-1 overflow-y-auto flex flex-col p-1 gap-1"},Ve={key:1,class:"flex-1 flex justify-center items-center"},Oe=l("p",{class:"text-2xl text-onDark"},"No messages yet",-1),Be=[Oe],Ee=f({__name:"ChatMain",props:{chatId:{type:String,required:!0}},setup(a){const t=a,c=w(),{chats:s}=j(c),r=v(()=>s.value.find(o=>o.id===t.chatId));return(e,o)=>(n(),u("section",Ne,[r.value&&r.value.messages?(n(),u("div",Pe,[(n(!0),u(C,null,U(r.value.messages,h=>(n(),y(we,{key:h.id,message:h},null,8,["message"]))),128))])):(n(),u("div",Ve,Be)),b(qe,{"chat-id":e.chatId},null,8,["chat-id"])]))}}),Te=m(Ee,[["__file","/home/luuk/code/realtime-chat/src/components/chat/ChatMain.vue"]]),ze={class:"flex h-full"},Ae={class:"w-80 bg-surface-100 h-full"},Fe=f({__name:"ChatView",props:{chatId:{type:null,required:!0}},setup(a){const t=x.currentUser;return(c,s)=>(n(),u("main",ze,[l("section",Ae,[b(ee,{user:p(t)},null,8,["user"]),b(be)]),c.chatId?(n(),y(Te,{key:0,chatId:c.chatId},null,8,["chatId"])):I("v-if",!0)]))}}),Je=m(Fe,[["__file","/home/luuk/code/realtime-chat/src/views/ChatView.vue"]]);export{Je as default};
